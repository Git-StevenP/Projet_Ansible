---

- name: Install yum-utils
  yum:
    name: yum-utils
    state: present

- name: Install the 'Development tools' package group
  yum:
    name: "@Development tools"
    state: present

- name: Install epel-release
  package:
    name: epel-release
    state: present

- name: Install python3 repository
  yum:
    name: https://centos7.iuscommunity.org/ius-release.rpm
    state: present

- name: Install python3.6 packages.
  yum:
    update_cache: True
    name:
      - python36u
      - python36u-libs
      - python36u-devel
      - python36u-pip
      - python36u-setuptools

- name: Install gcc compilator since it is required to install some of pip dependencies.
  yum:
    name: gcc

- name: Upgrade pip.
  command: pip3.6 install --upgrade pip

- name: Install setuptools
  yum:
    name: python-setuptools
    update_cache: yes
    state: latest


- name: Make /app directory
  file:
    path: /app
    state: directory


- name: Copy local app to the target and unzip it
  unarchive:
    src: data-engineering.tar
    dest: /app/

- name: Install python requirements
  pip:
    requirements: /app/data-engineering/requirements.txt
    executable: /bin/pip3.6
#  command: pip3 install -r /data-engineering/requirements.txt

- name: Copy local service config file to the target
  copy:
    src: app.service
    dest: /etc/systemd/system/

- name: Reload services
  command: systemctl daemon-reload

- name: Start app.service
  service:
    name: app.service
    enabled: yes
    state: started
